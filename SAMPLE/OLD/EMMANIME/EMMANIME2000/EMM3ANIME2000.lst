                                ;*** AILZ80ASM *** Z-80 Assembler, version 1.0.28.0, LST:Full:4
       00B1                     MONITOR     EQU     00B1H
       0832                     GETKEY      EQU     0832H
                                
       0003                     EMM     EQU     3           ;指定したEMM番号用のEMMLOADを作成
                                
                                #if emm == 0                        ;EMM I/Oポート設定
                                    EMM1        EQU     0A0H
                                #elif emm == 2
                                    EMM1        EQU     0A8H
                                #elif emm == 3
       00AC                         EMM1        EQU     0ACH
                                #else
                                    EMM1        EQU     0A4H
                                #endif
                                
                                
000000 12A0                             ORG 12A0H
                                
       12A0                     START:
000000 12A0 CDE612          17          CALL    GCLR
                                
000003 12A3 AF               4          XOR A           ;EMMアドレスリセット
000004 12A4 D3AC            11          OUT (EMM1),A
000006 12A6 D3AD            11          OUT (EMM1+1),A
000008 12A8 D3AE            11          OUT (EMM1+2),A
                                
00000A 12AA 3E9F             7          LD  A,9FH           ;G-RAMアクセス
00000C 12AC D3E8            11          OUT (0E8H),A
                                
00000E 12AE AF               4          XOR A
00000F 12AF D3F6            11          OUT (0F6H),A        ;G-RAM表示なし
000011 12B1 3C               4          INC A
000012 12B2 D3F7            11  ANI1:       OUT (0F7H),A        ;G-RAM(BLUE)書き込み
000014 12B4 CDD612          17          CALL    GWRITE
                                        
000017 12B7 3E01             7          LD  A,01H
000019 12B9 D3F6            11          OUT (0F6H),A        ;G-RAM(BLUE)表示
00001B 12BB 3C               4          INC A
00001C 12BC D3F7            11          OUT (0F7H),A        ;G-RAM(RED)書き込み
00001E 12BE CDD612          17          CALL    GWRITE
                                        
000021 12C1 CD3208          17          CALL    GETKEY          ;何かキーが押されていれば終了
000024 12C4 FE00             7          CP  00H
000026 12C6 2007            12          JR  NZ,MON
                                
000028 12C8 3E02             7          LD  A,02H
00002A 12CA D3F6            11          OUT (0F6H),A        ;G-RAM(RED)表示
00002C 12CC 3D               4          DEC A
00002D 12CD 18E3            12          JR  ANI1
                                        
00002F 12CF 3E5F             7  MON:        LD  A,5FH           ;メインメモリに切り替え
000031 12D1 D3E8            11          OUT (0E8H),A
000033 12D3 C3B100          10          JP  MONITOR         ;モニターに戻る
                                
                                
       12D6                     GWRITE:
000036 12D6 2100C0          10          LD  HL,0C000H       ;G-RAM先頭アドレス
000039 12D9 110040          10          LD  DE,4000H        ;G-RAMの大きさは3E7FHだが、4000HとしてEMMへの格納簡略化
       12DC                     LOP1:       
00003C 12DC DBAF            11          IN  A,(EMM1+3)      ;EMMからG-RAMへ1画面分転送
00003E 12DE 77               7          LD  (HL),A
00003F 12DF 23               6          INC HL
000040 12E0 1B               6          DEC DE
000041 12E1 7B               4          LD  A,E
000042 12E2 B2               4          OR  D
000043 12E3 20F7            12          JR  NZ,LOP1
000045 12E5 C9              10          RET
                                
                                
                                
000046 12E6 3E9F             7  GCLR:       LD  A,9FH           ;G-RAMアクセス
000048 12E8 D3E8            11          OUT (0E8H),A
00004A 12EA 0603             7          LD  B,03H           ;3画面分繰り返し
                                        
00004C 12EC 3E01             7          LD  A,01H
00004E 12EE D3F7            11  GC1:        OUT (0F7H),A
000050 12F0 C5              11          PUSH    BC
                                        
000051 12F1 2100C0          10          LD  HL,C000H        ;G-RAMクリア
000054 12F4 1101C0          10          LD  DE,C001H
000057 12F7 017F3E          10          LD  BC,3E7FH
00005A 12FA 3600            10          LD  (HL),00H
00005C 12FC EDB0                        LDIR
                                        
00005E 12FE C1              10          POP BC
00005F 12FF 3C               4          INC A
000060 1300 10EC            13          DJNZ    GC1
000062 1302 3E5F             7          LD  A,5FH           ;メインメモリに切り替え
000064 1304 D3E8            11          OUT (0E8H),A
                                        
000066 1306 C9              10          RET
                                        
                                        END
                                
[EOF:EMMANIME2000.s:UTF_8]
